{% extends "base.html" %}
{% block title %}Solicitud {{ s.numero_serie }}{% endblock %}
{% block content %}
<div class="container my-3">
  <div class="d-flex justify-content-between align-items-center">
    <h4 class="mb-0">Solicitud {{ s.numero_serie }}</h4>
    <a class="btn btn-outline-secondary" href="{{ url_for('ventas.listar_solicitudes') }}">Volver a solicitudes</a>
  </div>
  <div class="text-muted">Cliente: {{ s.cliente }}</div>

  <div class="mt-3">
    <a class="btn btn-primary"
       href="{{ url_for('pricing.cotizar', sol_id=s.id, tipo=tipo|default('maritimo')) }}">+ Nueva opción</a>
  </div>

  <hr>

  <h5 class="mt-3">Opciones de cotización</h5>
  {% set opciones = opciones|default([]) %}
  {% if opciones %}
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>#</th>
          <th>Proveedor</th>
          <th>Moneda</th>
          <th>CBM cotizado</th>
          <th>Ruta</th>
          <th>TT / Libres</th>
          <th>Creada</th>
          <th style="width:1%"></th>
        </tr>
      </thead>
      <tbody>
        {% for op in opciones %}
        <tr>
          <td>{{ op.id }}</td>
          <td>{{ op.proveedor }}</td>
          <td>{{ op.moneda }}</td>
          <td>{{ '%.4f' % op.cbm_cotizado if op.cbm_cotizado is not none else '-' }}</td>
          <td>
            {{ op.origen_final or '-' }} → {{ op.destino_final or '-' }}
            <div class="text-muted small">{{ op.frecuencia or '' }}</div>
          </td>
          <td>{{ op.transito_estimado_dias or '-' }} / {{ op.dias_libres_destino or '-' }}</td>
          <td>{{ op.created_at.strftime('%Y-%m-%d %H:%M') if op.created_at else '' }}</td>
          <td>
            <a class="btn btn-sm btn-outline-primary"
               href="{{ url_for('pricing.cotizar', sol_id=s.id, tipo=tipo|default('maritimo'), op_id=op.id) }}">Editar</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <div class="alert alert-info">Aún no hay opciones para esta solicitud.</div>
  {% endif %}
</div>
{% endblock %}
